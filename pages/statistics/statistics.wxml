<!-- statistics.wxml -->
<wxs src="./utils.wxs" module="utils" />

<view class="statistics-container">
  <!-- é¡µé¢æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æ•°æ®ç»Ÿè®¡ä¸åˆ†æ</text>
    <button class="refresh-btn" bindtap="refreshData">
      <text class="refresh-icon">ğŸ”„</text>
      <text class="refresh-text">åˆ·æ–°</text>
    </button>
  </view>

  <!-- æ‰‹åŠ¿æ¨¡å¼çƒ­åŠ›å›¾ -->
  <view class="section">
    <view class="section-title">
      <text class="title-icon">ğŸ”¥</text>
      <text class="title-text">æ‰‹åŠ¿æ¨¡å¼çƒ­åŠ›å›¾</text>
    </view>
    <view class="heatmap-container">
      <view class="heatmap-grid">
        <view class="heatmap-row" wx:for="{{heatmapData}}" wx:for-index="rowIndex" wx:key="rowIndex">
          <view
            class="heatmap-node"
            wx:for="{{item}}"
            wx:for-index="colIndex"
            wx:key="colIndex"
            style="
              width: {{utils.getHeatmapSize(item[colIndex])}}rpx;
              height: {{utils.getHeatmapSize(item[colIndex])}}rpx;
              background-color: {{utils.getHeatmapColor(item[colIndex])}};
              margin: {{utils.getHeatmapMargin(item[colIndex])}}rpx;
            "
          >
            <text class="heatmap-value">{{item[colIndex]}}</text>
          </view>
        </view>
      </view>
      <view class="heatmap-legend">
        <view class="legend-item">
          <view class="legend-color" style="background-color: #E0F3FF;"></view>
          <text class="legend-text">ä½</text>
        </view>
        <view class="legend-item">
          <view class="legend-color" style="background-color: #4DA6FF;"></view>
          <text class="legend-text">ä¸­</text>
        </view>
        <view class="legend-item">
          <view class="legend-color" style="background-color: #FF5C5C;"></view>
          <text class="legend-text">é«˜</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è§£é”æ—¶é—´åˆ†å¸ƒ -->
  <view class="section">
    <view class="section-title">
      <text class="title-icon">â±ï¸</text>
      <text class="title-text">è§£é”æ—¶é—´åˆ†å¸ƒ</text>
    </view>
    <canvas canvas-id="unlockTimeCanvas" class="chart-canvas"></canvas>
  </view>

  <!-- é”™è¯¯æ¨¡å¼åˆ†æ -->
  <view class="section">
    <view class="section-title">
      <text class="title-icon">âš ï¸</text>
      <text class="title-text">é”™è¯¯æ¨¡å¼åˆ†æ</text>
    </view>
    <canvas canvas-id="errorPatternCanvas" class="chart-canvas"></canvas>
  </view>

  <!-- ç»Ÿè®¡æ‘˜è¦ -->
  <view class="section">
    <view class="section-title">
      <text class="title-icon">ğŸ“Š</text>
      <text class="title-text">ç»Ÿè®¡æ‘˜è¦</text>
    </view>
    <view class="summary-container">
      <view class="summary-item">
        <view class="summary-number">{{utils.formatNumber(utils.sumArray(unlockTimeData))}}</view>
        <view class="summary-label">æ€»è§£é”æ¬¡æ•°</view>
      </view>
      <view class="summary-item">
        <view class="summary-number">{{utils.formatNumber(utils.sumArray(errorPatternData))}}</view>
        <view class="summary-label">æ€»é”™è¯¯æ¬¡æ•°</view>
      </view>
      <view class="summary-item">
        <view class="summary-number">
          {{utils.calculateAccuracy(
            utils.sumArray(unlockTimeData) - utils.sumArray(errorPatternData),
            utils.sumArray(unlockTimeData)
          )}}
        </view>
        <view class="summary-label">æ­£ç¡®ç‡</view>
      </view>
    </view>
  </view>
</view>
