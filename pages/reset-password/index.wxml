<view class="reset-password-page">
  <!-- 页面头部 -->
  <view class="page-header">
    <view class="page-title">重置手势密码</view>
    <view class="page-subtitle">{{resetType === 'security' ? '通过安全问题重置' : '通过验证码重置'}}</view>
  </view>

  <!-- 消息提示 -->
  <view class="message-box {{messageType}}" wx:if="{{message}}">
    {{message}}
  </view>

  <!-- 步骤指示器 -->
  <view class="step-indicator" wx:if="{{step > 1}}">
    <view class="step-item {{step >= 1 ? (step === 1 ? 'active' : 'completed') : ''}}">
      <view class="step-number">1</view>
      <view class="step-label">身份验证</view>
    </view>
    <view class="step-line"></view>
    <view class="step-item {{step >= 2 ? (step === 2 ? 'active' : 'completed') : ''}}">
      <view class="step-number">2</view>
      <view class="step-label">设置密码</view>
    </view>
    <view class="step-line"></view>
    <view class="step-item {{step >= 3 ? (step === 3 ? 'active' : 'completed') : ''}}">
      <view class="step-number">3</view>
      <view class="step-label">确认密码</view>
    </view>
    <view class="step-line"></view>
    <view class="step-item {{step >= 4 ? 'completed' : ''}}">
      <view class="step-number">4</view>
      <view class="step-label">完成</view>
    </view>
  </view>

  <!-- 身份验证：安全问题 -->
  <view class="verification-form" wx:if="{{step === 1 && resetType === 'security'}}">
    <view class="form-title">安全问题验证</view>

    <view class="form-group">
      <view class="form-label">安全问题</view>
      <input
        class="form-input disabled"
        value="{{securityQuestion}}"
        disabled>
      </input>
    </view>

    <view class="form-group">
      <view class="form-label">安全答案</view>
      <input
        class="form-input"
        placeholder="请输入安全答案"
        value="{{securityAnswer}}"
        bindinput="onSecurityAnswerInput"
        maxlength="50">
      </input>
    </view>

    <view class="button-group">
      <button class="btn btn-primary" bindtap="verifySecurityQuestion" disabled="{{isVerifying}}">
        {{isVerifying ? '验证中...' : '验证身份'}}
      </button>
      <button class="btn btn-secondary" bindtap="goBack">返回</button>
    </view>

    <view class="tip-text">请输入您设置的安全答案，验证通过后可重置手势密码</view>
  </view>

  <!-- 身份验证：验证码 -->
  <view class="verification-form" wx:if="{{step === 1 && resetType === 'verification'}}">
    <view class="form-title">验证码验证</view>

    <view class="verify-method-group">
      <view class="method-label">选择验证方式</view>
      <view class="method-options">
        <view class="method-option {{verifyMethod === 'sms' ? 'active' : ''}}" bindtap="onVerifyMethodChange" data-type="sms">
          短信验证 ({{targetPhone}})
        </view>
        <view class="method-option {{verifyMethod === 'email' ? 'active' : ''}}" bindtap="onVerifyMethodChange" data-type="email">
          邮箱验证 ({{targetEmail}})
        </view>
      </view>
    </view>

    <view class="form-group">
      <view class="form-label">验证码</view>
      <view class="code-input-group">
        <input
          class="form-input code-input"
          placeholder="请输入6位验证码"
          value="{{verificationCode}}"
          bindinput="onVerificationCodeInput"
          maxlength="6">
        </input>
        <button class="code-button {{codeButtonDisabled ? 'disabled' : 'enabled'}}" bindtap="getVerificationCode" disabled="{{codeButtonDisabled}}">
          {{codeButtonText}}
        </button>
      </view>
    </view>

    <view class="button-group">
      <button class="btn btn-primary" bindtap="verifyVerificationCode" disabled="{{isVerifying}}">
        {{isVerifying ? '验证中...' : '验证身份'}}
      </button>
      <button class="btn btn-secondary" bindtap="goBack">返回</button>
    </view>

    <view class="tip-text">验证码将发送至您选择的验证方式，请注意查收</view>
  </view>

  <!-- 验证中状态 -->
  <view class="verifying-section" wx:if="{{isVerifying}}">
    <view class="verifying-spinner"></view>
    <view class="verifying-text">正在验证身份...</view>
  </view>

  <!-- 设置新密码 -->
  <view class="gesture-container" wx:if="{{step === 2 || step === 3}}">
    <mini-gesture-lock
      container-width="{{containerWidth}}"
      cycleRadius="{{70}}"
      bind:end="onGestureEnd">
    </mini-gesture-lock>
  </view>

  <!-- 设置新密码提示 -->
  <view class="password-hint" wx:if="{{step === 2 || step === 3}}">
    {{step === 2 ? '请设置新的手势密码（至少连接4个点）' : '请再次输入相同的手势密码'}}
  </view>

  <!-- 设置密码按钮 -->
  <view class="button-group" wx:if="{{step === 2 || step === 3}}">
    <button class="btn btn-secondary" bindtap="goBack">返回上一步</button>
  </view>

  <!-- 密码设置中状态 -->
  <view class="verifying-section" wx:if="{{isSettingPassword}}">
    <view class="verifying-spinner"></view>
    <view class="verifying-text">正在设置新密码...</view>
  </view>

  <!-- 完成页面 -->
  <view class="completed-section" wx:if="{{step === 4}}">
    <view class="completed-icon"></view>
    <view class="completed-title">密码重置成功</view>
    <view class="completed-desc">您的手势密码已成功重置，请使用新密码登录</view>
  </view>

  <!-- 完成按钮 -->
  <view class="button-group" wx:if="{{step === 4}}">
    <button class="btn btn-primary" bindtap="goBack">返回</button>
  </view>
</view>