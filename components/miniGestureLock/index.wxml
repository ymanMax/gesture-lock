<wxs module="utils">
  var ceil = function(value) {
    return Math.ceil(value);
  }

  var formatComplexityLevel = function(level) {
    if (level === 'low') {
      return 'ä½';
    } else if (level === 'medium') {
      return 'ä¸­';
    } else if (level === 'high') {
      return 'é«˜';
    }
    return '';
  }

  var getLockedOverlayClass = function(isLocked) {
    return isLocked ? 'show' : '';
  }

  var getPeepOverlayClass = function(peepProof, isInputting) {
    return peepProof && isInputting ? 'show' : '';
  }

  var getGestureLockClass = function(error, isLocked) {
    var classes = [];
    if (error) {
      classes.push('error');
    }
    if (isLocked) {
      classes.push('disabled');
    }
    return classes.join(' ');
  }

  var getCycleClass = function(check) {
    return check ? 'check' : '';
  }

  module.exports = {
    ceil: ceil,
    formatComplexityLevel: formatComplexityLevel,
    getLockedOverlayClass: getLockedOverlayClass,
    getPeepOverlayClass: getPeepOverlayClass,
    getGestureLockClass: getGestureLockClass,
    getCycleClass: getCycleClass
  };
</wxs>

<view class="gesture-lock-wrapper">
  <!-- Locked overlay -->
  <view class="locked-overlay {{utils.getLockedOverlayClass(isLocked)}}" wx:if="{{isLocked}}">
    <view class="locked-content">
      <view class="locked-icon">ğŸ”’</view>
      <view class="locked-text">å·²é”å®š</view>
      <view class="locked-time">
        {{utils.ceil(remainingLockTime / 1000)}}ç§’åé‡è¯•
      </view>
    </view>
  </view>

  <!-- Peep-proof overlay -->
  <view class="peep-overlay {{utils.getPeepOverlayClass(peepProof, isInputting)}}" wx:if="{{peepProof}}">
    <view class="peep-text">æ‰‹åŠ¿è¾“å…¥ä¸­...</view>
  </view>

  <!-- Gesture lock -->
  <view class="gesture-lock {{utils.getGestureLockClass(error, isLocked)}}" style="width:{{containerWidth + 'rpx'}};height:{{containerWidth +'rpx'}}" bindtouchstart="onTouchStart" bindtouchmove="onTouchMove" bindtouchend="onTouchEnd">

    <!-- 9 ä¸ªåœ† -->
    <view class="cycle {{utils.getCycleClass(item.check)}}" wx:for="{{circleArray}}" wx:for-index="i" wx:for-item="item" wx:key="i" style="left:{{item.style.left}};top:{{item.style.top}};width:{{item.style.width}};height:{{item.style.width}}"></view>

    <!-- å·²æ¿€æ´»é”ä¹‹é—´çš„çº¿æ®µ -->
    <view class="line" wx:for="{{lineArray}}" wx:for-index="i" wx:for-item="item" wx:key="i" style="left:{{item.activeLeft}};top:{{item.activeTop}};width:{{item.activeWidth}};transform:rotate({{item.activeRotate}});"></view>

    <!-- æœ€åä¸€ä¸ªæ¿€æ´»çš„é”ä¸å½“å‰ä½ç½®ä¹‹é—´çš„çº¿æ®µ -->
    <view class="line" style="left:{{activeLine.activeLeft}};top:{{activeLine.activeTop}};width:{{activeLine.activeWidth}};transform:rotate({{activeLine.activeRotate}});"></view>
  </view>

  <!-- Failed attempts indicator -->
  <view class="attempts-indicator" wx:if="{{failedAttempts > 0}}">
    <view class="attempts-text">
      é”™è¯¯å°è¯•: {{failedAttempts}}/{{maxAttempts}}
    </view>
  </view>

  <!-- Complexity indicator -->
  <view class="complexity-indicator" wx:if="{{complexity > 0}}">
    <view class="complexity-text">
      å¤æ‚åº¦: {{complexity}}åˆ† ({{utils.formatComplexityLevel(complexityLevel)}})
    </view>
  </view>
</view>